// ============================================
// Ascension Example: File I/O
// Lettura e scrittura file
// ============================================

print("=== FILE I/O ===\n");

// -----------------------------------------
// SCRITTURA FILE
// -----------------------------------------
print("--- Scrittura File ---");

// Apri file in modalita' scrittura
handle = open("test_output.txt", "w");

if (handle == NULL) {
    print("Errore: impossibile aprire il file!");
} else {
    print("File aperto con successo");
    
    // Scrivi alcune righe
    write(handle, "Riga 1: Ciao da Ascension!\n");
    write(handle, "Riga 2: Questo e' un test.\n");
    write(handle, "Riga 3: File I/O funziona!\n");
    
    // Chiudi file
    close(handle);
    print("File scritto e chiuso");
}

// -----------------------------------------
// LETTURA FILE (tutto il contenuto)
// -----------------------------------------
print("\n--- Lettura File (tutto) ---");

handle = open("test_output.txt", "r");

if (handle == NULL) {
    print("Errore: file non trovato!");
} else {
    contenuto = read_all(handle);
    print("Contenuto file:");
    print(contenuto);
    close(handle);
}

// -----------------------------------------
// LETTURA FILE (riga per riga)
// -----------------------------------------
print("--- Lettura riga per riga ---");

handle = open("test_output.txt", "r");

if (handle != NULL) {
    riga_num = 1;
    while (true) {
        riga = read_line(handle);
        if (riga == "" || riga == NULL) {
            break;
        }
        print("Riga " + riga_num + ": " + riga);
        riga_num = riga_num + 1;
    }
    close(handle);
}

// -----------------------------------------
// APPEND A FILE ESISTENTE
// -----------------------------------------
print("\n--- Append a file ---");

handle = open("test_output.txt", "a");

if (handle != NULL) {
    write(handle, "Riga 4: Aggiunta con append!\n");
    write(handle, "Riga 5: Ultima riga.\n");
    close(handle);
    print("Righe aggiunte");
}

// Verifica append
print("\n--- Verifica dopo append ---");
handle = open("test_output.txt", "r");
if (handle != NULL) {
    print(read_all(handle));
    close(handle);
}

// -----------------------------------------
// ESEMPIO PRATICO: Log file
// -----------------------------------------
print("--- Esempio: Log ---");

func log_message(messaggio) {
    log = open("app.log", "a");
    if (log != NULL) {
        write(log, "[LOG] " + messaggio + "\n");
        close(log);
    }
}

log_message("Applicazione avviata");
log_message("Operazione completata");
log_message("Chiusura");

// Leggi log
print("Contenuto log:");
handle = open("app.log", "r");
if (handle != NULL) {
    print(read_all(handle));
    close(handle);
}

print("\n=== FINE ESEMPIO ===");
