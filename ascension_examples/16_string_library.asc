// ============================================
// Ascension Example: String Library
// Funzioni di utilita' per stringhe
// ============================================

print("=== STRING LIBRARY ===\n");

// -----------------------------------------
// FUNZIONI BASE
// -----------------------------------------

// Trova sottostringa (ritorna indice o -1)
func str_find(testo, cerca) {
    testo_len = len(testo);
    cerca_len = len(cerca);
    
    if (cerca_len > testo_len) {
        return -1;
    }
    
    i = 0;
    while (i <= testo_len - cerca_len) {
        found = true;
        j = 0;
        while (j < cerca_len) {
            if (testo[i + j] != cerca[j]) {
                found = false;
                break;
            }
            j = j + 1;
        }
        if (found) {
            return i;
        }
        i = i + 1;
    }
    return -1;
}

// Trova da posizione specifica
func str_find_from(testo, cerca, start) {
    testo_len = len(testo);
    cerca_len = len(cerca);
    
    if (start + cerca_len > testo_len) {
        return -1;
    }
    
    i = start;
    while (i <= testo_len - cerca_len) {
        found = true;
        j = 0;
        while (j < cerca_len) {
            if (testo[i + j] != cerca[j]) {
                found = false;
                break;
            }
            j = j + 1;
        }
        if (found) {
            return i;
        }
        i = i + 1;
    }
    return -1;
}

// Verifica se inizia con prefisso
func str_starts_with(testo, prefix) {
    if (len(prefix) > len(testo)) {
        return false;
    }
    i = 0;
    while (i < len(prefix)) {
        if (testo[i] != prefix[i]) {
            return false;
        }
        i = i + 1;
    }
    return true;
}

// Verifica se finisce con suffisso
func str_ends_with(testo, suffix) {
    if (len(suffix) > len(testo)) {
        return false;
    }
    offset = len(testo) - len(suffix);
    i = 0;
    while (i < len(suffix)) {
        if (testo[offset + i] != suffix[i]) {
            return false;
        }
        i = i + 1;
    }
    return true;
}

// Conta occorrenze
func str_count(testo, cerca) {
    count = 0;
    pos = 0;
    while (pos < len(testo)) {
        found = str_find_from(testo, cerca, pos);
        if (found == -1) {
            break;
        }
        count = count + 1;
        pos = found + 1;
    }
    return count;
}

// Verifica se contiene
func str_contains(testo, cerca) {
    return str_find(testo, cerca) != -1;
}

// Ripeti stringa n volte
func str_repeat(testo, n) {
    result = "";
    i = 0;
    while (i < n) {
        result = result + testo;
        i = i + 1;
    }
    return result;
}

// Inverti stringa
func str_reverse(testo) {
    result = "";
    i = len(testo) - 1;
    while (i >= 0) {
        result = result + testo[i];
        i = i - 1;
    }
    return result;
}

// Verifica palindromo
func str_is_palindrome(testo) {
    return testo == str_reverse(testo);
}

// Converti a uppercase (solo a-z)
func str_upper(testo) {
    result = "";
    i = 0;
    while (i < len(testo)) {
        c = testo[i];
        code = int(c);
        if (code >= 97 && code <= 122) {
            // a-z -> A-Z
            result = result + chr(code - 32);
        } else {
            result = result + c;
        }
        i = i + 1;
    }
    return result;
}

// Converti a lowercase (solo A-Z)
func str_lower(testo) {
    result = "";
    i = 0;
    while (i < len(testo)) {
        c = testo[i];
        code = int(c);
        if (code >= 65 && code <= 90) {
            // A-Z -> a-z
            result = result + chr(code + 32);
        } else {
            result = result + c;
        }
        i = i + 1;
    }
    return result;
}

// Padding a sinistra
func str_pad_left(testo, length, pad_char) {
    while (len(testo) < length) {
        testo = pad_char + testo;
    }
    return testo;
}

// Padding a destra
func str_pad_right(testo, length, pad_char) {
    while (len(testo) < length) {
        testo = testo + pad_char;
    }
    return testo;
}

// -----------------------------------------
// TEST DELLE FUNZIONI
// -----------------------------------------

print("--- Test str_find ---");
testo = "Hello World, Hello Universe";
print("Testo: '" + testo + "'");
print("Trova 'World': " + str_find(testo, "World"));
print("Trova 'Hello': " + str_find(testo, "Hello"));
print("Trova 'xyz': " + str_find(testo, "xyz"));

print("\n--- Test str_starts_with / str_ends_with ---");
print("Inizia con 'Hello': " + str_starts_with(testo, "Hello"));
print("Inizia con 'World': " + str_starts_with(testo, "World"));
print("Finisce con 'Universe': " + str_ends_with(testo, "Universe"));

print("\n--- Test str_count ---");
print("Conta 'Hello': " + str_count(testo, "Hello"));
print("Conta 'o': " + str_count(testo, "o"));

print("\n--- Test str_contains ---");
print("Contiene 'World': " + str_contains(testo, "World"));
print("Contiene 'Mars': " + str_contains(testo, "Mars"));

print("\n--- Test str_repeat ---");
print("Ripeti 'ab' 5 volte: " + str_repeat("ab", 5));

print("\n--- Test str_reverse ---");
print("Inverti 'Ascension': " + str_reverse("Ascension"));

print("\n--- Test str_is_palindrome ---");
print("'radar' palindromo: " + str_is_palindrome("radar"));
print("'hello' palindromo: " + str_is_palindrome("hello"));

print("\n--- Test str_upper / str_lower ---");
print("Upper 'Hello World': " + str_upper("Hello World"));
print("Lower 'Hello World': " + str_lower("Hello World"));

print("\n--- Test str_pad ---");
print("Pad left '42' a 5 con '0': " + str_pad_left("42", 5, "0"));
print("Pad right 'hi' a 6 con '-': " + str_pad_right("hi", 6, "-"));

print("\n=== FINE ESEMPIO ===");
