// ============================================
// Ascension Example: HTTP Networking
// Richieste HTTP GET e POST
// ============================================

print("=== HTTP NETWORKING ===\n");

// -----------------------------------------
// HTTP GET
// -----------------------------------------
print("--- HTTP GET ---");
print("Richiesta a http://example.com...\n");

response = http_get("http://example.com");

if (response == NULL) {
    print("Errore: richiesta fallita");
} else {
    print("Status: ");
    print(response.status);
    
    if (response.status == 200) {
        print("\nRisposta ricevuta con successo!");
        print("Dimensione body: ");
        print(len(response.body));
        
        // Mostra primi 200 caratteri
        print("\nPrimi 200 caratteri:");
        if (len(response.body) > 200) {
            print(substr(response.body, 0, 200));
            print("...");
        } else {
            print(response.body);
        }
    }
}

// -----------------------------------------
// HTTP GET con API pubblica
// -----------------------------------------
print("\n\n--- HTTP GET API ---");
print("Richiesta a httpbin.org/get...\n");

response = http_get("http://httpbin.org/get");

if (response != NULL && response.status == 200) {
    print("Risposta API:");
    // httpbin ritorna JSON, lo stampiamo
    if (len(response.body) > 500) {
        print(substr(response.body, 0, 500));
        print("...");
    } else {
        print(response.body);
    }
} else {
    print("Errore nella richiesta API");
}

// -----------------------------------------
// HTTP POST
// -----------------------------------------
print("\n\n--- HTTP POST ---");
print("POST a httpbin.org/post...\n");

// Dati da inviare
dati = {};
dati["nome"] = "Ascension";
dati["versione"] = "12.5";
dati["tipo"] = "test";

response = http_post("http://httpbin.org/post", dati);

if (response != NULL && response.status == 200) {
    print("POST completato!");
    print("Status: ");
    print(response.status);
    
    // Mostra parte della risposta
    print("\nRisposta (primi 300 char):");
    if (len(response.body) > 300) {
        print(substr(response.body, 0, 300));
    } else {
        print(response.body);
    }
} else {
    print("Errore nel POST");
}

// -----------------------------------------
// Funzione helper per GET semplificato
// -----------------------------------------
func fetch_url(url) {
    print("Fetching: " + url);
    resp = http_get(url);
    if (resp == NULL) {
        return NULL;
    }
    if (resp.status != 200) {
        print("Errore HTTP: ");
        print(resp.status);
        return NULL;
    }
    return resp.body;
}

print("\n\n--- Funzione fetch_url ---");
html = fetch_url("http://example.com");
if (html != NULL) {
    print("Ricevuti ");
    print(len(html));
    print(" bytes");
}

print("\n=== FINE ESEMPIO ===");
