// ============================================
// Ascension Example: System Commands
// Esecuzione comandi di sistema
// ============================================

print("=== SYSTEM COMMANDS ===\n");

// -----------------------------------------
// SYSTEM - Esegui e ottieni exit code
// -----------------------------------------
print("--- system() - Exit Code ---\n");

// Comando che esiste
print("Esecuzione 'echo Hello':");
exit_code = system("echo Hello from system");
print("Exit code: ", exit_code);

// Comando che non esiste
print("\nEsecuzione comando inesistente:");
exit_code = system("comando_inesistente_xyz 2>/dev/null");
print("Exit code: ", exit_code);

// -----------------------------------------
// EXEC - Esegui e ottieni output
// -----------------------------------------
print("\n--- exec() - Cattura Output ---\n");

// Data corrente
print("Data corrente:");
data = exec("date");
print(data);

// Hostname
print("Hostname:");
host = exec("hostname");
print(host);

// User corrente
print("User:");
user = exec("whoami");
print(user);

// -----------------------------------------
// ESEMPIO: Wrapper per comandi comuni
// -----------------------------------------
print("\n--- Funzioni Wrapper ---\n");

func get_current_dir() {
    return exec("pwd");
}

func list_files() {
    return exec("ls");
}

print("Directory corrente:");
print(get_current_dir());

print("\nFile nella directory:");
print(list_files());

// -----------------------------------------
// ESEMPIO: File operations con system
// -----------------------------------------
print("\n--- File Operations ---\n");

// Crea un file di test
print("Creazione file test...");
handle = open("test_system.txt", "w");
if (handle != NULL) {
    write(handle, "Contenuto di test\nRiga 2\nRiga 3\n");
    close(handle);
    print("File creato!");
    
    // Leggi con cat
    print("\nContenuto (via cat):");
    output = exec("cat test_system.txt");
    print(output);
    
    // Conta righe con wc
    print("Numero righe:");
    righe = exec("wc -l < test_system.txt");
    print(righe);
    
    // Pulizia
    system("rm test_system.txt");
    print("\nFile rimosso.");
} else {
    print("Errore creazione file!");
}

// -----------------------------------------
// ESEMPIO: Check dipendenze
// -----------------------------------------
print("\n--- Check Dipendenze ---\n");

func check_command(cmd) {
    // which ritorna 0 se il comando esiste
    result = system("which " + cmd + " > /dev/null 2>&1");
    if (result == 0) {
        print(cmd + ": DISPONIBILE");
        return 1;
    } else {
        print(cmd + ": NON TROVATO");
        return 0;
    }
}

check_command("python3");
check_command("git");
check_command("curl");
check_command("node");

// -----------------------------------------
// ESEMPIO: Informazioni di sistema
// -----------------------------------------
print("\n--- Info Sistema ---\n");

print("Kernel:");
print(exec("uname -r"));

print("Architettura:");
print(exec("uname -m"));

print("Uptime:");
print(exec("uptime"));

print("\n=== FINE ESEMPIO ===");
